#!/usr/bin/dyalogscript

⎕io←0
⎕pp←22

f ← 2 0 1⍉(≢f)2 2⍴f←⎕json¨↑(⎕d,'-')∘(∊⍨⊆⊢)¨⊃⎕nget'day15.txt'1
x y d ← (⊂⍤(⊣⌿⊣⌿),⊂⍤(⊢⌿⊣⌿),⊂⍤(+⍥|⌿-⌿))f

mrg ← {(⊢/⊃⌽⍵) < ⊃⍺ : ⍵,⊂⍺ ⋄ (¯1↓⍵),⊂(⊃⊃⌽⍵),(⊢/⊃⌽⍵)⌈⊢/⍺}/⍤⌽⍤(⊂⍤⊂⍤⊃,1∘↓)
s   ← {⍵/⍨≤/¨⍵} x (-,+)¨ d-|2e6-y
bc  ← +/(2e6=⊢/)¨∪↓⍉⊢⌿f
⎕←'part 1: ',bc-⍨+/(1+-⍨/)¨⊃mrg s[⍋s]

(up down) ← (y(-,⍥⊂+)x) (+,-)¨⊂1+d
pts  ← {⍵/⍨∧⌿(0∘≤∧≤∘4e6)⍵} ÷∘2 {⍵/⍨∧⌿~2|⍵} ⍉↑, down∘.(-,+)up
⎕←'part 2: ',⍕4e6 1+.×pts⌷⍨⍤1 0⊢⊂⊃⍸∧⌿d <⍤0 1 +⍥|⌿(⊣⌿f)(∘.-)⍤1⊢pts
